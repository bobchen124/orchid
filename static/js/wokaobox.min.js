(function(n,t,i,r){var ht="none",it="elastic",st="click.fb",yt="afterClose",rt="ajax",b="inline",g="swf",w="image",kt="afterLoad",pt="beforeLoad",nt=".fb",p="body",wt="keypress.fb",c="auto",d="iframe",ut="scroll",at="hidden",et="overflow",ot="wokaobox-opened",vt=".wokaobox-item, .wokaobox-nav",k="onReset",ft=".wokaobox-wrap",bt="onCancel",ct="fade",v="html",o=!0,f=null,e=!1,l=i(n),a=i(t),u=i.wokaobox=function(){u.open.apply(this,arguments)},tt=e,dt=f,h=t.createTouch!==r,y=function(n){return i.type(n)==="string"},lt=function(n){return y(n)&&n.indexOf("%")>0},s=function(n,t){return t&&lt(n)&&(n=u.getViewport()[t]/100*parseInt(n,10)),Math.round(n)+"px"};i.extend(u,{defaults:{width:800,height:600,minWidth:100,minHeight:100,maxWidth:9999,maxHeight:9999,autoSize:o,autoResize:!h,autoCenter:!h,fitToView:o,aspectRatio:e,topRatio:.4,fixed:e,scrolling:"no",wrapCSS:"",closeBtn:o,closeClick:e,preload:3,modal:e,ajax:{dataType:v,headers:{"X-wokaoBox":o}},keys:{close:[27]},index:0,type:f,href:f,content:f,tpl:{wrap:'<div class="wokaobox-wrap"><div class="wokaobox-skin"><div class="wokaobox-outer"><div class="wokaobox-inner"></div></div></div></div>',image:'<img class="wokaobox-image" src="{href}" alt="" />',iframe:'<iframe class="wokaobox-iframe" name="wokaobox-frame{rnd}" frameborder="0" hspace="0"'+(i.browser.msie?' allowtransparency="true"':"")+"></iframe>",swf:'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="wmode" value="transparent" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="{href}" /><embed src="{href}" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="100%" height="100%" wmode="transparent"></embed></object>',error:'<p class="wokaobox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<div title="关闭" class="wokaobox-item wokaobox-close"></div>'},openEffect:ct,openSpeed:300,openEasing:"swing",openOpacity:o,openMethod:"zoomIn",closeEffect:ct,closeSpeed:300,closeEasing:"swing",closeOpacity:o,closeMethod:"zoomOut",helpers:{overlay:{speedIn:0,speedOut:300,opacity:.5,css:{cursor:"pointer"},closeClick:o}},onCancel:i.noop,beforeLoad:i.noop,afterLoad:i.noop,beforeShow:i.noop,afterShow:i.noop,beforeClose:i.noop,afterClose:i.noop},group:{},opts:{},coming:f,current:f,isOpen:e,isOpened:e,wrap:f,skin:f,outer:f,inner:f,player:{timer:f,isActive:e},ajaxLoad:f,imgPreload:f,transitions:{},helpers:{},open:function(n,t){u.close(o),n&&!i.isArray(n)&&(n=n instanceof i?i(n).get():[n]),u.isActive=o,u.opts=i.extend(o,{},u.defaults,t),i.isPlainObject(t)&&t.keys!==r&&(u.opts.keys=t.keys?i.extend({},u.defaults.keys,t.keys):e),u.group=n,u._start(u.opts.index||0)},cancel:function(){u.coming&&e===u.trigger(bt)||(u.coming=f,u.hideLoading(),u.ajaxLoad&&u.ajaxLoad.abort(),u.ajaxLoad=f,u.imgPreload&&(u.imgPreload.onload=u.imgPreload.onabort=u.imgPreload.onerror=f))},close:function(n){(u.cancel(),u.current&&e!==u.trigger("beforeClose"))&&(u.unbindEvents(),!u.isOpen||n&&n[0]===o?(i(ft).stop().trigger(k).remove(),u._afterZoomOut()):(u.isOpen=u.isOpened=e,i(vt).remove(),u.wrap.stop(o).removeClass(ot),u.inner.css(et,at),u.transitions[u.current.closeMethod]()))},reposition:function(n,t){var i;u.isOpen&&(i=u._getPosition(t),n&&n.type===ut?(delete i.position,u.wrap.stop(o,o).animate(i,200)):u.wrap.css(i))},update:function(n){u.isOpen&&(tt||(dt=setTimeout(function(){var t=u.current,i=!n||n&&n.type==="orientationchange";if(tt){if(tt=e,!t)return;(!n||n.type!==ut||i)&&(t.autoSize&&t.type!==d&&(u.inner.height(c),t.height=u.inner.height()),(t.autoResize||i)&&u._setDimension(),t.canGrow&&t.type!==d&&u.inner.height(c)),(t.autoCenter||i)&&u.reposition(n),u.trigger("onUpdate")}},200)),tt=o)},toggle:function(){u.isOpen&&(u.current.fitToView=!u.current.fitToView,u.update())},hideLoading:function(){a.unbind(wt),i("#wokaobox-loading").remove()},showLoading:function(){u.hideLoading(),a.bind(wt,function(n){n.keyCode===27&&(n.preventDefault(),u.cancel())}),i('<div id="wokaobox-loading"><div></div></div>').click(u.cancel).appendTo(p)},getViewport:function(){return{x:l.scrollLeft(),y:l.scrollTop(),w:h&&n.innerWidth?n.innerWidth:l.width(),h:h&&n.innerHeight?n.innerHeight:l.height()}},unbindEvents:function(){u.wrap&&u.wrap.unbind(nt),a.unbind(nt),l.unbind(nt)},bindEvents:function(){var n=u.current,t=n.keys;n&&(l.bind("resize.fb orientationchange.fb"+(n.autoCenter&&!n.fixed?" scroll.fb":""),u.update),t&&a.bind("keydown.fb",function(n){var f,r=n.target||n.srcElement;n.ctrlKey||n.altKey||n.shiftKey||n.metaKey||r&&(r.type||i(r).is("[contenteditable]"))||(f=n.keyCode,i.inArray(f,t.close)>-1&&(u.close(),n.preventDefault()))}))},trigger:function(n,t){var f,r=t||u[i.inArray(n,[bt,pt,kt])>-1?"coming":"current"];if(r){if(i.isFunction(r[n])&&(f=r[n].apply(r,Array.prototype.slice.call(arguments,1))),f===e)return e;r.helpers&&i.each(r.helpers,function(t,f){f&&i.isPlainObject(u.helpers[t])&&i.isFunction(u.helpers[t][n])&&u.helpers[t][n](f,r)}),i.event.trigger(n+nt)}},isImage:function(n){return y(n)&&n.match(/\.(jpe?g|gif|png|bmp)((\?|#).*)?$/i)},isSWF:function(n){return y(n)&&n.match(/\.(swf)((\?|#).*)?$/i)},_start:function(n){var t={},h=u.group[n]||f,l,s,r,p,a;if(h&&(h.nodeType||h instanceof i)&&(l=o,i.metadata&&(t=i(h).metadata())),t=i.extend(o,{},u.opts,{index:n,element:h},i.isPlainObject(h)?h:t),i.each(["href","content","type"],function(n,r){t[r]=u.opts[r]||l&&i(h).attr(r)||t[r]||f}),t.modal&&i.extend(o,t,{closeBtn:e,closeClick:e,keys:f,helpers:{overlay:{css:{cursor:c},closeClick:e}}}),u.coming=t,e===u.trigger(pt)){u.coming=f;return}r=t.type,s=t.href||h,r||(l&&(r=i(h).data("wokaobox-type"),r||(p=h.className.match(/wokaobox\.(\w+)/),r=p?p[1]:f)),!r&&y(s)&&(u.isImage(s)?r=w:u.isSWF(s)?r=g:s.match(/^#/)&&(r=b)),r||(r=l?b:v),t.type=r),r===b||r===v?(t.content||(t.content=r===b?i(y(s)?s.replace(/.*(?=#[^\s]+$)/,""):s):h),t.content&&t.content.length||(r=f)):s||(r=f),r===rt&&y(s)&&(a=s.split(/\s+/,2),s=a.shift(),t.selector=a.shift()),t.href=s,t.group=u.group,t.isDom=l;switch(r){case w:u._loadImage();break;case rt:u._loadAjax();break;case b:case d:case g:case v:u._afterLoad();break;default:u._error("type")}},_error:function(n){u.hideLoading(),i.extend(u.coming,{type:v,autoSize:o,minWidth:0,minHeight:0,hasError:n,content:u.coming.tpl.error}),u._afterLoad()},_loadImage:function(){var n=u.imgPreload=new Image;n.onload=function(){var n=this;n.onload=n.onerror=f,u.coming.width=n.width,u.coming.height=n.height,u._afterLoad()},n.onerror=function(){this.onload=this.onerror=f,u._error(w)},n.src=u.coming.href,n.complete!==r&&n.complete||u.showLoading()},_loadAjax:function(){u.showLoading(),u.ajaxLoad=i.ajax(i.extend({},u.coming.ajax,{url:u.coming.href,error:function(n,t){u.coming&&t!=="abort"?u._error(rt,n):u.hideLoading()},success:function(n,t){t==="success"&&(u.coming.content=n,u._afterLoad())}}))},_preloadImages:function(){var f=u.group,e=u.current,o=f.length,n,r,t,s=Math.min(e.preload,o-1);if(e.preload&&!(f.length<2))for(t=1;t<=s;t+=1)n=f[(e.index+t)%o],r=n.href||i(n).attr("href")||n,(n.type===w||u.isImage(r))&&((new Image).src=r)},_afterLoad:function(){if(u.hideLoading(),!u.coming||e===u.trigger(kt,u.current)){u.coming=e;return}u.isOpened?(i(vt).remove(),u.wrap.stop(o).removeClass(ot),u.inner.css(et,at),u.transitions.changeOut()):(i(ft).stop().trigger(k).remove(),u.trigger(yt)),u.unbindEvents(),u.isOpen=e,u.current=u.coming,u.wrap=i(u.current.tpl.wrap).addClass("wokaobox-"+(h?"mobile":"desktop")+" wokaobox-type-"+u.current.type+" wokaobox-tmp "+u.current.wrapCSS).appendTo(p),u.skin=i(".wokaobox-skin",u.wrap),u.outer=i(".wokaobox-outer",u.wrap),u.inner=i(".wokaobox-inner",u.wrap),u._setContent()},_setContent:function(){var n=u.current,t=n.content,f=n.type,a=n.minWidth,y=n.minHeight,nt=n.maxWidth,l=n.maxHeight,r;switch(f){case b:case rt:case v:n.selector?t=i("<div>").html(t).find(n.selector):t instanceof i&&(t.parent().hasClass("wokaobox-inner")&&t.parents(ft).unbind(k),t=t.show().detach(),i(u.wrap).bind(k,function(){t.appendTo(p).hide()})),n.autoSize&&(r=i('<div class="wokaobox-wrap '+u.current.wrapCSS+' wokaobox-tmp"></div>').appendTo(p).css({minWidth:s(a,"w"),minHeight:s(y,"h"),maxWidth:s(nt,"w"),maxHeight:s(l,"h")}).append(t),n.width=r.width(),n.height=r.height(),r.width(u.current.width),r.height()>n.height&&(r.width(n.width+1),n.width=r.width(),n.height=r.height()),t=r.contents().detach(),r.remove());break;case w:t=n.tpl.image.replace("{href}",n.href),n.aspectRatio=o;break;case g:t=n.tpl.swf.replace(/\{width\}/g,n.width).replace(/\{height\}/g,n.height).replace(/\{href\}/g,n.href);break;case d:t=i(n.tpl.iframe.replace("{rnd}",+new Date)).attr("scrolling",n.scrolling).attr("src",n.href),n.scrolling=h?ut:c}(f===w||f===g)&&(n.autoSize=e,n.scrolling="visible"),f===d&&n.autoSize?(u.showLoading(),u._setDimension(),u.inner.css(et,n.scrolling),t.bind({onCancel:function(){i(this).unbind(),u._afterZoomOut()},load:function(){u.hideLoading();try{this.contentWindow.document.location&&(u.current.height=i(this).contents().find(p).height())}catch(n){u.current.autoSize=e}u[u.isOpen?"_afterZoomIn":"_beforeShow"]()}}).appendTo(u.inner)):(u.inner.append(t),u._beforeShow())},_beforeShow:function(){u.coming=f,u.trigger("beforeShow"),u._setDimension(),u.wrap.hide().removeClass("wokaobox-tmp"),u.bindEvents(),u._preloadImages(),u.transitions[u.current.openMethod]()},_setDimension:function(){var w=u.wrap,b=u.inner,r=u.current,p=u.getViewport(),n=r.width,t=r.height,a=r.maxWidth,f=r.maxHeight,v=r.minWidth,y=r.minHeight,l,h;if(lt(n)&&(n=p.w*parseFloat(n)/100),lt(t)&&(t=p.h*parseFloat(t)/100),l=n/t,r.fitToView&&(a=Math.min(p.w,a),f=Math.min(p.h,f)),r.aspectRatio?(n>a&&(n=a,t=n/l),t>f&&(t=f,n=t*l),n<v&&(n=v,t=n/l),t<y&&(t=y,n=t*l)):(n=Math.max(v,Math.min(n,a)),t=Math.max(y,Math.min(t,f))),n=Math.round(n),t=Math.round(t),i(w.add(b)).width(c).height(c),b.width(n).height(t),w.width(n),h=w.height(),n>a||h>f)while((n>a||h>f)&&n>v&&h>y)t=t-10,r.aspectRatio?(n=Math.round(t*l),n<v&&(n=v,t=n/l)):n=n-10,b.width(n).height(t),w.width(n),h=w.height();r.dim={width:s(n),height:s(h)},r.canGrow=r.autoSize&&t>y&&t<f,r.canShrink=e,r.canExpand=e,n<r.width||t<r.height?r.canExpand=o:(n>p.w||h>p.h)&&n>v&&t>y&&(r.canShrink=o),u.innerSpace=h-b.height()},_getPosition:function(n){var r=u.current,i=u.getViewport(),f=u.wrap.width(),e=u.wrap.height(),t={position:"absolute",top:i.y,left:i.x};return r.autoCenter&&r.fixed&&!n&&e<=i.h&&f<=i.w&&(t={position:"fixed",top:0,left:0}),t.top=s(Math.max(t.top,t.top+(i.h-e)*r.topRatio)),t.left=s(Math.max(t.left,t.left+(i.w-f)*.5)),t},_afterZoomIn:function(){var n=u.current,t=n?n.scrolling:"no";n&&(u.isOpen=u.isOpened=o,u.wrap.addClass(ot),u.inner.css(et,t==="yes"?ut:t==="no"?at:t),u.trigger("afterShow"),u.update(),n.closeClick&&u.inner.css("cursor","pointer").bind(st,function(n){i(n.target).is("a")||i(n.target).parent().is("a")||u.close()}),n.closeBtn&&i(n.tpl.closeBtn).appendTo(u.skin).bind(st,u.close))},_afterZoomOut:function(){var n=u.current;u.wrap.trigger(k).remove(),i.extend(u,{group:{},opts:{},current:f,isActive:e,isOpened:e,isOpen:e,wrap:f,skin:f,outer:f,inner:f}),u.trigger(yt,n)}}),u.transitions={getOrigPosition:function(){var e=u.current,o=e.element,n=i(e.orig),t={},h=50,f=50,r;return!n.length&&e.isDom&&i(o).is(":visible")&&(n=i(o).find("img:first"),n.length||(n=i(o))),n.length?(t=n.offset(),n.is("img")&&(h=n.outerWidth(),f=n.outerHeight())):(r=u.getViewport(),t.top=r.y+(r.h-f)*.5,t.left=r.x+(r.w-h)*.5),t={top:s(t.top),left:s(t.left),width:s(h),height:s(f)}},step:function(n,t){var r=t.prop,f,i;(r==="width"||r==="height")&&(f=Math.ceil(n),r==="height"&&(i=(n-t.start)/(t.end-t.start),t.start>t.end&&(i=1-i),f-=u.innerSpace*i),u.inner[r](f))},zoomIn:function(){var s=u.wrap,t=u.current,e=t.openEffect,r=e===it,h=t.dim,n=i.extend({},h,u._getPosition(r)),o=i.extend({opacity:1},n);delete o.position,r?(n=this.getOrigPosition(),t.openOpacity&&(n.opacity=0),u.outer.add(u.inner).width(c).height(c)):e===ct&&(n.opacity=0),s.css(n).show().animate(o,{duration:e===ht?0:t.openSpeed,easing:t.openEasing,step:r?this.step:f,complete:u._afterZoomIn})},zoomOut:function(){var i=u.wrap,n=u.current,r=n.openEffect,e=r===it,t={opacity:0};e&&(i.css("position")==="fixed"&&i.css(u._getPosition(o)),t=this.getOrigPosition(),n.closeOpacity&&(t.opacity=0)),i.animate(t,{duration:r===ht?0:n.closeSpeed,easing:n.closeEasing,step:e?this.step:f,complete:u._afterZoomOut})},changeIn:function(){var e=u.wrap,f=u.current,r=it,t=r===it,n=u._getPosition(t),i={opacity:1};n.opacity=0,t&&(n.top=s(parseInt(n.top,10)-200),i.top="+=200px"),e.css(n).show().animate(i,{duration:r===ht?0:f.openSpeed,easing:f.openEasing,complete:u._afterZoomIn})},changeUp:function(){var r=u.wrap,i=u.current,n=u._getPosition(o),t={opacity:1};n.opacity=0,n.top=s(parseInt(n.top,10)+200),t.top="-=200px",r.css(n).show().animate(t,{duration:i.openSpeed,easing:i.openEasing,complete:u._afterZoomIn})},changeOut:function(){var i=u.wrap,t=u.current,n={opacity:0};i.removeClass(ot),n.top="+=200px",i.animate(n,{duration:t.closeSpeed,easing:t.closeEasing,complete:u._afterZoomOut})}},u.helpers.overlay={overlay:f,update:function(){var r,n,u;this.overlay.width("100%").height("100%"),i.browser.msie||h?(n=Math.max(t.documentElement.scrollWidth,t.body.scrollWidth),u=Math.max(t.documentElement.offsetWidth,t.body.offsetWidth),r=n<u?l.width():n):r=a.width(),this.overlay.width(r).height(a.height())},beforeShow:function(t){var r=this;r.overlay||(t=i.extend(o,{},u.defaults.helpers.overlay,t),r.overlay=i('<div id="wokaobox-overlay"></div>').css(t.css).appendTo(p),t.closeClick&&r.overlay.bind(st,u.close),u.current.fixed&&!h?r.overlay.addClass("overlay-fixed"):(r.update(),r.onUpdate=function(){this.update()}),i.browser.msie?r.overlay.fadeTo(t.speedIn,t.opacity):r.overlay.fadeTo(t.speedIn,1))},afterClose:function(n){this.overlay&&this.overlay.fadeOut(n.speedOut||0,function(){i(this).remove()}),this.overlay=f}},i.fn.wokaobox=function(n){var r="click.fb-start",f=i(this),t=this.selector||"",o,e=function(r){var e=this,c=o,h,s;r.ctrlKey||r.altKey||r.shiftKey||r.metaKey||i(e).is(ft)||(r.preventDefault(),h=n.groupAttr||"data-wokaobox-group",s=i(e).attr(h),s||(h="rel",s=e[h]),s&&s!==""&&s!=="nofollow"&&(e=t.length?i(t):f,e=e.filter("["+h+'="'+s+'"]'),c=e.index(this)),n.index=c,u.open(e,n))};return n=n||{},o=n.index||0,t?a.undelegate(t,r).delegate(t,r,e):f.unbind(r).bind(r,e),this},i(t).ready(function(){u.defaults.fixed=i.support.fixedPosition||!(i.browser.msie&&i.browser.version<=6)&&!h})})(window,document,jQuery);